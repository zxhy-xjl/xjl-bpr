<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>流程图DEMO</title>
<!--[if lt IE 9]>
<?import namespace="v" implementation="#default#VML" ?>
<![endif]-->
<!--<link rel="stylesheet" type="text/css" href="codebase/GooFlow2.css"/>-->
<link rel="stylesheet" type="text/css" href="codebase/GooFlow.css" />
<script type="text/javascript" src="../jquery.min.js"></script>
<script type="text/javascript" src="../GooFunc.js"></script>
<script type="text/javascript" src="../json2.js"></script>
<link rel="stylesheet" type="text/css" href="../default.css" />
<script type="text/javascript" src="codebase/GooFlow.js"></script>
<script type="text/javascript">
    var graphicid = new Array(); //存放每个图形的id
    var i=0;      //数组长度计数
	var property = {
		width : 1200,
		height : 500,
		toolBtns : [ "start round", "end", "task", "node", "chat", "state",
				"plug", "join", "fork", "complex mix" ],
		haveHead : true,
		headBtns : [ "new", "open", "save", "undo", "redo", "reload" ],//如果haveHead=true，则定义HEAD区的按钮
		haveTool : true,
		haveGroup : true,
		useOperStack : true
	};
	var remark = {
		"cursor" : "选择指针",
		"direct" : "转换连线",
		"start" : "开始结点",
		"end" : "结束结点",
		"task" : "任务结点",
		"node" : "自动结点",
		"chat" : "决策结点",
		"state" : "状态结点",
		"plug" : "附加插件",
		"fork" : "分支结点",
		"join" : "联合结点",
		"complex" : "复合结点",
		"group" : "组织划分框编辑开关"
	};
	var demo;
	//初始化
	$(document).ready(function() {
		demo = $.createGooFlow($("#demo"), property);
		demo.setNodeRemarks(remark);
		 jsondata = {
			"nodes" : {
				"demo_node_1" : {
					"name" : "起始1",
					"left" : 51,
					"top" : 29,
					"type" : "start round",
					"width" : 24,
					"height" : 24,
					"alt" : true
				},
		
				"demo_node_2" : {
					"name" : "起始4",
					"left" : 49,
					"top" : 230,
					"type" : "start round",
					"width" : 24,
					"height" : 24,
					"alt" : true
				}
			},
			"lines" : {},
			"areas" : {}
		};
		demo.loadData(jsondata);  
	});

	//根据工作区元素以JSON格式导出
	function Export() {
		document.getElementById("result").value = JSON.stringify(demo.exportData());
	}
	
	//根据JSON导入工作流元素
	function Import(){
	var data = document.getElementById("result").value;	
	if(data!=null&&data!="")
	{       
		i=0;
		var datab=eval('('+data+')');
		var demodata =demo.exportData();
		var str1 = JSON.stringify(datab);
		var str2 = JSON.stringify(demodata);
		if(str1==str2)
			return;
		for (var key in datab.nodes)
			{
			graphicid[i] = key;
			i++;
			}
		for (var key in demodata.nodes)
		{
		for(var m=0;m<graphicid.length;m++)
			{
			if(graphicid[m]==key)
				{
				alert("有重复的id,请检查输入的json字符串!");
				//清空数组元素
				graphicid.length=0;
				return;
				}	
			}
		}
				demo.loadData(datab);
				graphicid.length=0;
	}
	}

	//清除工作区
	function clearAll(){
		demo.clearData();	
	}
	
</script>
</head>
<body>
	<div id="demo" style="margin: 10px"></div>
	<a href="workflowAPI20160811.doc">API下载</a>
	<input id="submit" type="button" value='导出结果' onclick="Export()" />
	<input id="import" type="button" value="反向生成" onclick="Import()" />
	<textarea id="result" row="6" style="height: 200px;width: 600px;"></textarea>
	<input id="clear" type="button" value="清除工作区" onclick="clearAll()" />
	<label style="color: red;">说明：删除元素请点击右上角叉号或者按下del键，双击元素名称可以改名</label>
</body>
</html>
